<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chamada Online - Aluno</title>
  <link rel="stylesheet" href="styleA.css">
<div class="container">
  <img src="logos/A3.gif" alt="Decoração esquerda" class="side-img">
</div>
<div class="card">
    <h2>Registro de Presença</h2>
    <div class="input-group">
      <input id="nome" type="text" placeholder="Seu nome">
      <input id="matricula" type="text" placeholder="Matrícula">
    </div>
    <button onclick="registrarPresenca()">Enviar Presença</button>
    <div id="saida"></div>
     
  </div>

  <img src="logos/A2(A).gif" alt="Decoração direita" class="side-img right">
<script>
async function registrarPresenca() {

// Gerar ou obter um ID único para o dispositivo
  function getDeviceId() {
  let deviceId = localStorage.getItem("deviceId");
  if (!deviceId) {
    deviceId = crypto.randomUUID();
    localStorage.setItem("deviceId", deviceId);
  }
  return deviceId;
}

  const matricula = document.getElementById("matricula").value;

  if (!matricula) {
    alert("Digite sua matricula antes de enviar!");
    return;
  }
  // Pegar nome
  const nome = document.getElementById("nome").value;

  if (!nome) {
    alert("Digite seu nome antes de enviar!");
    return;
  }

  const deviceId = getDeviceId(); // Pega o deviceId único

  // Pegar horário atual
  const horario = new Date().toLocaleString();

  // Pegar localização (latitude e longitude)
  navigator.geolocation.getCurrentPosition(async (pos) => {
    const latitude = pos.coords.latitude;
    const longitude = pos.coords.longitude;

    const res = await fetch("http://localhost:3000/presenca", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nome, matricula, horario, latitude, longitude, deviceId })
    });

    const data = await res.json();
    document.getElementById("saida").innerText = data.msg;

  }, (err) => {
    alert("Não foi possível obter a localização.");
    console.error(err);
  });
}
</script>
